<!doctype html><html lang=en>
<head>
<title>Command Pattern :: Design and Implementation</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="このエントリの目指すところ 以下の観点で調査/検討する． どのようなシーンで使えるのか なぜそのシーンで使えるのか 必要に応じてプログラムに起こす．">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=https://sparrow-blue.github.io/blog/posts/design_pattern/command_pattern/>
<link rel=stylesheet href=https://sparrow-blue.github.io/blog/styles.css>
<link rel="shortcut icon" href=https://sparrow-blue.github.io/blog/img/theme-colors/green.png>
<link rel=apple-touch-icon href=https://sparrow-blue.github.io/blog/img/theme-colors/green.png>
<meta name=twitter:card content="summary">
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="Command Pattern">
<meta property="og:description" content="このエントリの目指すところ 以下の観点で調査/検討する． どのようなシーンで使えるのか なぜそのシーンで使えるのか 必要に応じてプログラムに起こす．">
<meta property="og:url" content="https://sparrow-blue.github.io/blog/posts/design_pattern/command_pattern/">
<meta property="og:site_name" content="Design and Implementation">
<meta property="og:image" content="https://sparrow-blue.github.io/blog/img/favicon/green.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">
<meta property="article:section" content="design">
<meta property="article:published_time" content="2023-06-13 00:00:00 +0000 UTC">
</head>
<body class=green>
<div class="container full headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/blog/>
<div class=logo>
Design and Implementation
</div>
</a>
</div>
<ul class="menu menu--mobile">
<li class=menu__trigger>Menu&nbsp;▾</li>
<li>
<ul class=menu__dropdown>
<li><a href=/blog/profile/>Profile</a></li>
</ul>
</li>
</ul>
</div>
<nav class=navigation-menu>
<ul class="navigation-menu__inner menu--desktop">
<li><a href=/blog/profile/>Profile</a></li>
</ul>
</nav>
</header>
<div class=content>
<article class=post>
<h1 class=post-title>
<a href=https://sparrow-blue.github.io/blog/posts/design_pattern/command_pattern/>Command Pattern</a>
</h1>
<div class=post-meta><time class=post-date>2023-06-13[Updated::2023-06-13]</time></div>
<span class=post-tags>
#<a href=https://sparrow-blue.github.io/blog/tags/command_pattern/>command_pattern</a>&nbsp;
#<a href=https://sparrow-blue.github.io/blog/tags/design_pattern/>design_pattern</a>&nbsp;
</span>
<div class=post-content><div>
<h2 id=このエントリの目指すところ>このエントリの目指すところ<a href=#このエントリの目指すところ class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<p>以下の観点で調査/検討する．</p>
<ol>
<li>どのようなシーンで使えるのか</li>
<li>なぜそのシーンで使えるのか</li>
</ol>
<p>必要に応じてプログラムに起こす．</p>
<h2 id=調査>調査<a href=#調査 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h3 id=語られる像>語られる像<a href=#語られる像 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<ul>
<li><a href=https://ja.wikipedia.org/wiki/Command_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3>Wikipedia - Command パターン</a>
<blockquote>
<p>リクエストのために必要な手続きとデータをCommandオブジェクトとしてカプセル化した上で取り回し[1]、必要に応じてExecute（実行）するパターンである。オブジェクトであることを生かして命令のキューイングやロギング、Undo等が可能になり[2]、Executeを分離したことで手続きと実行を疎結合にできる。</p>
</blockquote>
</li>
<li><a href=https://www.techscore.com/tech/DesignPattern/Command>TECHSCORE - 22. Commandパターン</a>
<blockquote>
<p>あるオブジェクトに対して要求を送るということは、そのオブジェクトのメソッドを呼び出すことと同じです。 そして、メソッドにどのような引数を渡すか、ということによって要求の内容は表現されます。さまざまな要求を送ろうとすると、引数の数や種類を増やさなければなりませんが、 それには限界があります。そこで要求自体をオブジェクトにしてしまい、そのオブジェクトを引数に渡すようにします。それがCommandパターンです。</p>
</blockquote>
</li>
<li><a href=https://zenn.dev/morinokami/books/learning-patterns-1/viewer/command-pattern>フロントエンドのデザインパターン - コマンドパターン</a>
<blockquote>
<p>コマンドパターン (command pattern) を用いると、あるタスクを実行するオブジェクトと、そのメソッドを呼び出すオブジェクトを切り離すことができことができます。</p>
</blockquote>
</li>
<li><a href=https://www.itsenka.com/contents/development/designpattern/command.html>IT専科 - Command パターン</a>
<blockquote>
<p>「Command」という英単語は、「命令」を意味します。
このパターンでは、1つもしくは複数の命令を1つのオブジェクトで表現(命令の詳細処理をカプセル化)します。また、命令をオブジェクトとして管理するため、その命令の履歴管理、UNDO(取消し)機能の実装等が容易に行えます。</p>
</blockquote>
</li>
</ul>
<h3 id=整理>整理<a href=#整理 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<ol>
<li>Command Pattern の典型的な用例として Undo/Redo が挙げられる</li>
<li>手続き一式を隠ぺいし，オブジェクトとして取り扱えるようにする</li>
<li>手続きがオブジェクトとして扱われることで，キューイングや呼び出し履歴の記録が可能になる</li>
<li>ある手続きを定義したとして，それを実行する責務と分離される</li>
</ol>
<h3 id=疑問>疑問<a href=#疑問 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<ol>
<li>Redo はともかく Undo をどのように実現するのか
<ul>
<li>Command に対する入力と出力を保持しておくということか</li>
</ul>
</li>
</ol>
<h2 id=要点>要点<a href=#要点 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h2 id=検討>検討<a href=#検討 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h3 id=どのようなシーンで使えるのか>どのようなシーンで使えるのか<a href=#どのようなシーンで使えるのか class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<h3 id=なぜそのシーンで使えるのか>なぜそのシーンで使えるのか<a href=#なぜそのシーンで使えるのか class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<h2 id=実例>実例<a href=#実例 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h3 id=設計>設計<a href=#設計 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<h3 id=実装>実装<a href=#実装 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>#include
#include
#include
#include
#include
#include </p>
<p>namespace DesignPattern {
namespace CommandPattern {
/**</p>
<ul>
<li>描画される図形の抽象クラス
*/
class Diagram {
public:
Diagram() : height(0), width(0) {}
virtual ~Diagram() = 0;
int height;
int width;
std::string to_string() {
std::stringstream ss;
ss &#171; typeid(this).name() &#171; &ldquo;: "
&#171; &ldquo;(&rdquo; &#171; this->height &#171; &ldquo;,&rdquo; &#171; this->width &#171; &ldquo;)";
return ss.str();
}
};
Diagram::~Diagram() {}</li>
</ul>
<p>/**</p>
<ul>
<li>図形が描画されるキャンバス
*/
class Canvas {
public:
void AddDiagram(std::shared_ptr diagram) {
this->diagrams.push_back(diagram);
}
void dump() {
std::for_each(
this->diagrams.begin(), this->diagrams.end(),
[](auto diagram) { std::cout &#171; diagram->to_string() &#171; std::endl; });
}</li>
</ul>
<p>private:
std::vector&lt;std::shared_ptr> diagrams;
};</p>
<p>/**</p>
<ul>
<li>線分を表現するクラス
*/
class Line : public Diagram {
public:
Line() { this->width = 10; }
};</li>
</ul>
<p>/**</p>
<ul>
<li>三角形を表現するクラス
*/
class Triangle : public Diagram {
public:
Triangle() {
this->width = 10;
this->height = 5;
}
};</li>
</ul>
<p>/**</p>
<ul>
<li>コマンドの抽象クラス
*/
class Command {
public:
Command(std::shared_ptr<a href=DesignPattern::CommandPattern::Canvas>DesignPattern::CommandPattern::Canvas</a> canvas_)
: canvas(canvas_) {}
virtual void Execute() = 0;</li>
</ul>
<p>protected:
std::shared_ptr canvas;
};</p>
<p>/*</p>
<ul>
<li>線分の生成を担うコマンド
*/
class CreateLineDiagramCommand : public Command {
public:
CreateLineDiagramCommand(
std::shared_ptr<a href=DesignPattern::CommandPattern::Canvas>DesignPattern::CommandPattern::Canvas</a> canvas_)
: Command(canvas_) {}
virtual void Execute() {
auto new_diagram = std::make_shared();
this->canvas->AddDiagram(new_diagram);
}
};</li>
</ul>
<p>/*</p>
<ul>
<li>三角形の生成を担うコマンド
*/
class CreateTriangleDiagramCommand : public Command {
public:
CreateTriangleDiagramCommand(
std::shared_ptr<a href=DesignPattern::CommandPattern::Canvas>DesignPattern::CommandPattern::Canvas</a> canvas_)
: Command(canvas_) {
auto new_diagram = std::make_shared();
this->canvas->AddDiagram(new_diagram);
}
virtual void Execute() {}
};</li>
</ul>
<p>/*</p>
<ul>
<li>図形の移動を担うコマンド
*/
class MoveDiagramCommand : public Command {
public:
virtual void Execute() {}
};</li>
</ul>
<p>/*</p>
<ul>
<li>図形のリサイズを担うコマンド
*/
class ResizeDiagramCommand : public Command {
public:
virtual void Execute() {}
};
} // namespace CommandPattern
} // namespace DesignPattern</li>
</ul>
<p>using namespace DesignPattern::CommandPattern;
int main() {
auto canvas = std::make_shared();
auto execution_queue = std::queue&lt;std::shared_ptr>();
auto execution_history = std::list&lt;std::shared_ptr>();</p>
<p>std::cout &#171; &ldquo;# initial state&rdquo; &#171; std::endl;
canvas->dump();</p>
<p>execution_queue.push(std::make_shared(canvas));
execution_queue.push(std::make_shared(canvas));</p>
<p>while (execution_queue.size()) {
auto command = execution_queue.front();
command->Execute();
execution_history.push_back(command);
execution_queue.pop();
}</p>
<p>std::cout &#171; &ldquo;# final state&rdquo; &#171; std::endl;
canvas->dump();
}</p>
<h3 id=実行結果>実行結果<a href=#実行結果 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<pre><code>$ clang++ command_pattern.cpp  -o command_pattern.out
$ ./command_pattern.out 
# initial state
# final state
PN13DesignPattern14CommandPattern7DiagramE: (5,10)
PN13DesignPattern14CommandPattern7DiagramE: (0,10)
</code></pre>
</div></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button next">
<a href=https://sparrow-blue.github.io/blog/posts/2023-06-11/>
<span class=button__text>ブログを書くことにした</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</article>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=copyright>
<span>© 2023 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span>
</div>
</div>
</footer>
<script type=text/javascript src=/blog/bundle.min.js></script>
</div>
</body>
</html>